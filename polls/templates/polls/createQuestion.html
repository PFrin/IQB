
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>IODA Group IQB</title>
        <meta name="description" content="implémentation d'un backoffice. Conception, mise en production de formulaire "/>
        <link rel="canonical" href="https://www.iodagroup.com/"/>
        <meta property="og:locale" content="fr_FR"/>
        <meta property="og:type" content="website"/>
        <meta property="og:title" content="IODA Group Question Backoffice"/>
        <meta property="og:description" content="implémentation d'un backoffice. Conception, mise en production de formulaire "/>
        <meta property="og:site_name" content="IODA Group IQB"/>

        <link rel="icon" href="https://www.iodagroup.com/wp-content/uploads/2021/10/cropped-IODA-LOGO-SEUL-32x32.png" sizes="32x32"/>
        <link rel="icon" href="https://www.iodagroup.com/wp-content/uploads/2021/10/cropped-IODA-LOGO-SEUL-192x192.png" sizes="192x192"/>
        <link rel="apple-touch-icon" href="https://www.iodagroup.com/wp-content/uploads/2021/10/cropped-IODA-LOGO-SEUL-180x180.png"/>
        <meta name="msapplication-TileImage" content="https://www.iodagroup.com/wp-content/uploads/2021/10/cropped-IODA-LOGO-SEUL-270x270.png"/>
        <link href="https://fonts.googleapis.com/css?family=Oswald:100,200,300,400,500,600,700,800,900|Poppins:100,200,300,400,500,600,700,800,900" rel="stylesheet">

        <style>
            .Question {
                background-color: grey;
                margin-top: 10px;
            }
        </style>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <script>
            $(document).ready(function() {
                console.log("prêt");
                $('.key').change(function() {
                    var key_question = $(this).closest('.question').attr('id');
                    var key_page = $(this).closest('.page').attr('id'); 
                    var key_value;
                    var key_id = $(this).attr('id');
                    var key_type = "question"
                    //var key_type = $(this).closest('.question').attr('id');
                    var key_name = $(this).attr('name');
                    console.log("changement")

                    if ($(this).is('input[type="checkbox"]')) { // checkbox
                        key_value = $(this).is(':checked');
                        console.log(key_value)
                    } else if ($(this).is('select')) {
                        key_value = $(this).val(key_type);
                    } else {
                        key_value = $(this).val();
                    }
                    

                    console.log("Nouvelle valeur de l'élément avec l'ID '" + key_id + "': " + key_value);

                    $.ajax({
                        type: 'POST',
                        url: '{% url "QuestionView" %}', // l'URL vue Django
                        data: {
                            'action': "update",
                            'key_value': key_value, 
                            'key_id': key_id,
                            'key_type': key_type,
                            'key_page':key_page,
                            'key_question':key_question,
                            'key_name':key_name
                            
                        },
                        success: function(response) {
                            if (response.success) {
                                console.log("succes");
                            } else {
                                console.log("echec");
                            }
                        }
                    });
                });
            });

            function duplicateQuestion(btn) {
                var key_page = $(btn).closest('.page').attr('id');
                $.ajax({
                    type: 'POST',
                    url: '{% url "QuestionView" %}', // l'URL vue Django
                    data: {
                        'action': "duplicateQuestion",
                        'key_page':key_page
                    },
                    success: function(response) {
                        if (response.success) {
                            console.log("succes");
                            //créer la page dynamiquement ou refresh la page
                            location.reload()
                        } else {
                            console.log("echec");
                        }
                    }
                });
            }

            function addQuestion(btn) {
                var key_page = $(btn).closest('.page').attr('id');
                $.ajax({
                    type: 'POST',
                    url: '{% url "QuestionView" %}', // l'URL vue Django
                    data: {
                        'action': "addQuestion",
                        'key_page':key_page
                    },
                    success: function(response) {
                        if (response.success) {
                            console.log("succes");
                            //créer la page dynamiquement ou refresh la page
                            location.reload()
                        } else {
                            console.log("echec");
                        }
                    }
                });
            }

            function removeQuestion(btn){
                var key_question = $(btn).closest('.question').attr('id');
                $.ajax({
                    type: 'POST',
                    url: '{% url "QuestionView" %}', // l'URL vue Django
                    data: {
                        'action': "removeQuestion",
                        'question_id':key_question
                    },
                    success: function(response) {
                        if (response.success) {
                            console.log("succes");
                            //surpimer la question dynamiquement ou refresh la page
                            location.reload()

                        } else {
                            console.log("echec");
                        }
                    }
                });
            }
            
                
        </script>

    </head>
    <center>
        <body class="navbar navbar-expend-lg navbar-light">
            <h1>Création/modification Form</h1>
            
    <!--
    <div style="background-color:grey">
        <form method="post">
            <label for="type-select">Choose a type:</label>
            <select name="type" id="type-select" onchange="showFields();">
                {% for x in myType%}
                <option value="{{ x.typeQuestion}}"> {{ x.typeQuestion}}</option>
                {% endfor %}
            </select>
            {% csrf_token %}
            {{ form.as_p }}
            <button type="Remove" id="Remove">Supprimer</button>
            <button type="Submit" id="dupliquer">dupliquer</button>
            Si btn déjà valider changer en btn Modifier
        </form>
    </div>
        
    --> 

            <hr>
            {% for form in info_form %}
                <h2 class="key" name ="{{ form.form.titleForm.name }}">titre :{{ form.form.titleForm }}</h2> <!-- titleForm   class   name -->

                {% for page in form.pages %}
                    <div id='allPages'>
                        <h3 class="page">Page {{ page.page.number }}</h3> 
                        <div id="{{ page.page.idPage }}" class="page">
                            
                            {% for question in page.questions %}
                            <form method="post">
                                {% csrf_token %}
                                <div id="{{ question.question.idQuestion }}" class="question">
                                    <input name="{{ form.form.titleForm.title }}" type="text" class="key" value="{{ question.question.title }}">    <!-- title   class   name -->
                                    <br>
                                    <input id="{{ question.question.idQuestion }}" class="key" name="{{ question.question.idQuestion.name }}" type="checkbox" {% if question.question.isObligatory %}checked{% endif %}>isObligatory</input> <!-- isObligatory   class   name id -->
                                    <br>
                                    <label for="type-select">Choose a type:</label>
                                    <select name="type" id="type-select" class="key">
                                        {% for x in myType%}
                                        <option value="{{ x.typeQuestion}}"> {{ x.typeQuestion}}</option>
                                        {% endfor %}
                                    </select>

                                    <p class="key">nbr réponse Min :{{ question.question.nbrAnswerMin }}</p>
                                    <p class="key">nbr réponse Max :{{ question.question.nbrAnswerMax }}</p>  <!-- lst déroulante en fonction du nbr de propositions de questions-->

                                    {% for answer in question.answers %}
                                    <div id="{{ answer.idAnswer }}" class="reponse">
                                        <input type="text" class="key" value="{{ answer.Answer }}">
                                    </div >
                                    {% endfor %}
                                    <button type="button" id="{{ question.question.idQuestion }}" onclick="removeQuestion(this);">Supprimer</button>
                                    <button type="button" id="{{ question.question.idQuestion }}" onclick="duplcate(this);">dupliquer</button>

                                </div>
                            </form>
                            {% endfor %}
                        <button type="Submit" id="addQuestion" onclick="addQuestion(this);">Ajouter une Question</button>
                        <hr>
                        </div>
                    </div>
                    
                {% endfor %}
            {% endfor %}
            </div>
            


        </body>
    </center>
</html>
